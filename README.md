# Parking Backend Spring

## Project Description and Structure

This repository contains the backend for the ChatChatABC parking system. The backend system currently contains 4
modules developed using `Spring Boot` and written with `Java` and `Kotlin` and follows `Domain Driven Design`. The
project follows a `monorepo` structure where all the modules are contained in a single repository.

- `Parking API` [(parking-api)](parking-api)

  This module is a `Spring Boot` application. It contains the REST API for the Parking Owners and Parking Members. It is
  primarily written in `Kotlin`. It is capable of providing authentication and authorization to owners and members.

  This module is dependent on the `Parking Domain` and `Parking Web Common` module.

- `Parking Admin` [(parking-admin)](parking-admin)

  This module is also a `Spring Boot` application. It also contains the REST API and GraphQL endpoints for the Parking
  Admin. It is also primarily written in `Kotlin`. It is capable of providing authentication and authorization to
  admins.

  This module is dependent on the `Parking Domain` and `Parking Web Common` module.

- `Parking Domain` [(parking-domain)](parking-domain)

  This module is a `Java` shared library. It contains the domain models and business logic for the Parking System. The
  entire project is dependent on this module.

- `Parking Web Common `[(parking-web-common)](parking-web-common)

  This module is a `Java` shared library. It contains the common web components for the Parking System such as the
  [JwtService.java](parking-web-common/src/main/java/com/chatchatabc/parking/web/common/application/rest/service/JwtService.java)
  and its implementation and the configuration for
  the [Spring Security](parking-web-common/src/main/java/com/chatchatabc/parking/web/common/application/config/security/SecurityConfig.java).

## Project Terminologies

- `Members`: Refers to the users of the system. They can be assigned with any role.
- `Roles`: Refers to the roles a `member` can have. The project current supports the following roles:
    - `Parking Owners`: Refers to the owners of the parking lots. They can register a parking lot. NOTE: An owner
      account can only have one registered parking lot. Please see this repository for
      the [Parking Owner Mobile Application](https://github.com/chatchatabc/parking-mobile-kmm)
    - `Parking Members`: Refers to the base users of the Parking System. Please see this repository for
      the [Parking Member Mobile Application](https://github.com/chatchatabc/parking-mobile-kmm)
    - `Parking Admins`: Refers to the admins of the Parking System. They access the admin dashboard through a separate
      web application. Please see this repository for
      the [Parking Admin Dashboard](https://github.com/chatchatabc/parking-admin-react)
    - `Parking Enforcers`: Refers to the government entities that has access to the Parking System. They can review and
      perform actions based on the `Reports` generated by the `members` and `parking owners`.
- `Parking Lots`: Refers to the parking lots registered by the `parking owners`. A parking lot has to be verified for it
  to appear publicly on the map.
- `Vehicles`: Refers to the vehicles of the `members`. A `member` can own and have access to multiple vehicles.
- `Invoices`: Refers to the invoices generated by the `parking owners` for the `members`. The `members` can pay the
  invoices through the `member mobile application` or other preferred payment methods.
- `Reports`: Refers to the reports generated by the `members` and `parking owners`. Anyone can report any traffic or
  vehicle related violations. The reports will then be visible to the `enforcers` for review and action.

## Tech Stack

This project is built using a variety of tools, libraries, and technologies. Listed below are the major ones:

- Languages:
    - [Java 17](https://docs.oracle.com/en/java/)
    - [Kotlin 1.8](https://kotlinlang.org/docs/home.html)
- Framework:
    - [Spring Boot 3.1.0-RC2](https://mvnrepository.com/artifact/org.springframework.boot/spring-boot/3.1.0-RC2)
- Technologies:
    - [NATS](https://nats.io/)
    - [Aliyun OSS](https://www.alibabacloud.com/product/oss)
- Build Tool:
    - [Maven 3.8.1](https://maven.apache.org/guides/index.html)
- API:
    - [GraphQL](https://graphql.org/)
    - [REST](https://restfulapi.net/)
- Authentication and Authorization:
    - [JWT](https://jwt.io/)
    - [Spring Security](https://spring.io/projects/spring-security)
- Database:
    - [PostgreSQL 15.2](https://www.postgresql.org/docs/15/index.html)
    - [Redis 7.0.11](https://redis.io/documentation)-
- Libraries:
    - [Spring Data JPA](https://spring.io/projects/spring-data-jpa)
    - [Spring Boot Actuator](https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html)
    - [Swagger UI](https://swagger.io/tools/swagger-ui/)
    - [Quartz Scheduler](https://www.quartz-scheduler.org/)
    - [Hibernate](https://hibernate.org/)
    - [MapStruct](https://mapstruct.org/)
    - [Lombok](https://projectlombok.org/)
- Testing and Tools:
    - [JUnit 5](https://junit.org/junit5/docs/current/user-guide/)
    - [Testcontainers](https://www.testcontainers.org/)
    - [Flyway](https://flywaydb.org/documentation/)
    - [DBUnit](http://dbunit.sourceforge.net/)
    - [DBRider](https://database-rider.github.io/database-rider/latest/documentation.html?theme=foundation)
- CI/CD
    - [GitHub Actions](https://docs.github.com/en/actions)
- Containerization
    - [Docker](https://docs.docker.com/)
    - [Docker Compose](https://docs.docker.com/compose/)

## Get Started

``` shell
mvn -DdbHost=${$(docker compose port postgres 5432)#*:}
```

## Diagrams and Flowchart

### Entity Relationship Diagram

![Entity Relationship Diagram](./src/site/images/erd.png)

### Flowchart

![Flowchart](./src/site/images/flowchart.png)

## Goals

- Two Apps
    - Member App
    - Parking Owner App
- One Admin Dashboard
- QR Code Scanning
- Invoicing
- Real Time Map
- Spring Boot Backend

## TODOs

- [x] Flowchart
- [x] UI Wireframe
- [x] Entity Relationship Diagram
- [ ] Redis
    - [ ] for Forgot Password
    - [x] for OTP
- [ ] Member App
    - [ ] Android App
    - [ ] iOS App
- [ ] Parking Owner App
    - [ ] Android App
    - [ ] iOS App
- [ ] Admin Dashboard
    - [ ] Spring Boot Backend
    - [ ] React Frontend
- [ ] Spring Boot Backend
    - [x] Member Registration
    - [x] Owner Registration
    - [x] Authentication
    - [ ] Logout (just delete token?)
    - [x] Vehicle API
    - [x] Parking Lot API
    - [x] Invoicing API
    - [ ] Scanning of QR Code
    - [ ] Real Time Map
- [ ] Add Surefire Plugin as dependency
    - sequence of plugins for pom
    - compiler first on build
    - maven surefire testing plugin
    - packaging
- [x] Add actuator dependency to all spring boots
    - [x] Admin
    - [x] API
- [ ] Unit Testing with Audrey
    - [ ] Database Track
    - [ ] Test Container
    - [ ] Spring Boot Test
    - [ ] MVC Test
    - [ ] DB Test
    - [ ] Unit Test on Domain
- [x] use flyway for init of data (dont use init or data init)

## Security TODO:

- [ ] NATS use same JWT as API
- [ ] NATS use same JWT as Admin
- [ ] JWT Auth on GraphQL
- [ ] Members with NATS should only be "listen" only
- [ ] Add more fields to member
    - [x] Integer ID (hidden, don't expose)
    - [x] Another UUID member id
    - [x] Another UUID for notification ID

https://oss.console.aliyun.com/bucket/oss-ap-southeast-6/davao-parking/object

# Unit test

* Spring Boot Test
* Testcontainers integration with Spring Boot 3.1.0
* Flyway for database schema
* Database Rider for dataset

[//]: # (jbang)

# References

* [Parking Admin Dashboard](https://github.com/chatchatabc/parking-admin-react)
* [Parking Mobile App](https://github.com/chatchatabc/parking-mobile-kmm)
* [Spring Boot 3.1.0-RC2](https://mvnrepository.com/artifact/org.springframework.boot/spring-boot/3.1.0-RC2)
* [Java 17](https://docs.oracle.com/en/java/)
* [Kotlin 1.8.21](https://kotlinlang.org/docs/home.html)
* [NATS](https://nats.io/)
* [Aliyun OSS](https://www.alibabacloud.com/product/oss)
* [Maven 3.8.1](https://maven.apache.org/guides/index.html)
* [GraphQL](https://graphql.org/)
* [REST](https://restfulapi.net/)
* [JWT](https://jwt.io/)
* [Spring Security](https://spring.io/projects/spring-security)
* [PostgreSQL 15.2](https://www.postgresql.org/docs/15/index.html)
* [Redis 7.0.11](https://redis.io/documentation)
* [Spring Data JPA](https://spring.io/projects/spring-data-jpa)
* [Spring Boot Actuator](https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html)
* [Swagger UI](https://swagger.io/tools/swagger-ui/)
* [Quartz Scheduler](https://www.quartz-scheduler.org/)
* [Hibernate](https://hibernate.org/)
* [MapStruct](https://mapstruct.org/)
* [Lombok](https://projectlombok.org/)
* [JUnit 5](https://junit.org/junit5/docs/current/user-guide/)
* [Testcontainers](https://www.testcontainers.org/)
* [Flyway](https://flywaydb.org/documentation/)
* [DBUnit](http://dbunit.sourceforge.net/)
* [DBRider](https://database-rider.github.io/database-rider/latest/documentation.html?theme=foundation)
* [GitHub Actions](https://docs.github.com/en/actions)
* [Docker](https://docs.docker.com/)
* [Docker Compose](https://docs.docker.com/compose/)